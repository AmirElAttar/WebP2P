<!DOCTYPE html> 
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>P2P File Sharing Client</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #1a2a6c);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        h1 {
            color: #1a2a6c;
            font-size: 2.5rem;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        h1 i {
            font-size: 2rem;
        }
        
        .mode-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            background: #f0f4f8;
            padding: 10px 20px;
            border-radius: 30px;
            font-weight: 600;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }
        
        .switch input { 
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 30px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: #2ecc71;
        }
        
        input:checked + .slider:before {
            transform: translateX(30px);
        }
        
        .config-section {
            background: #f8fafc;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            border-left: 4px solid #3498db;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        
        .config-section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .input-group {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .input-group label {
            font-weight: 600;
            min-width: 150px;
            color: #2c3e50;
        }
        
        .input-group input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid #cbd5e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border 0.3s;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-primary {
            background: #3498db;
            color: white;
        }
        
        .btn-success {
            background: #2ecc71;
            color: white;
        }
        
        .btn-warning {
            background: #f39c12;
            color: white;
        }
        
        .btn-danger {
            background: #e74c3c;
            color: white;
        }
        
        .status-bar {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-family: 'Courier New', monospace;
        }
        
        .status-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .status-indicator {
            display: inline-block;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-indicator.online {
            background: #2ecc71;
            box-shadow: 0 0 10px #2ecc71;
        }
        
        .status-indicator.offline {
            background: #e74c3c;
        }
        
        .files-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .files-container {
            background: #f8fafc;
            border-radius: 10px;
            padding: 20px;
            border-left: 4px solid #3498db;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        
        .files-container h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .file-list {
            list-style: none;
            max-height: 300px;
            overflow-y: auto;
            border-radius: 8px;
            background: white;
            padding: 10px;
            border: 1px solid #e2e8f0;
        }
        
        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 10px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .file-item:last-child {
            border-bottom: none;
        }
        
        .file-info {
            flex: 1;
        }
        
        .file-name {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .file-size {
            font-size: 14px;
            color: #718096;
        }
        
        .file-actions {
            display: flex;
            gap: 8px;
        }
        
        .action-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .download-btn {
            background: #3498db;
            color: white;
        }
        
        .output-section {
            background: #2c3e50;
            color: #ecf0f1;
            border-radius: 10px;
            padding: 20px;
            height: 250px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
        }
        
        .log-entry {
            margin-bottom: 12px;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .log-timestamp {
            color: #a0aec0;
            font-size: 12px;
            margin-right: 10px;
        }
        
        .log-success {
            color: #68d391;
        }
        
        .log-error {
            color: #fc8181;
        }
        
        .log-warning {
            color: #f6e05e;
        }
        
        .log-info {
            color: #63b3ed;
        }
        
        .progress {
            width: 100%;
            height: 6px;
            background: #e2e8f0;
            border-radius: 3px;
            margin-top: 5px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: #2ecc71;
            transition: width 0.3s ease;
        }
        
        .mode-badge {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 14px;
            z-index: 10;
        }
        
        .mock-mode {
            background: #e74c3c;
            color: white;
        }
        
        .real-mode {
            background: #2ecc71;
            color: white;
        }
        
        @media (max-width: 768px) {
            .files-section {
                grid-template-columns: 1fr;
            }
            
            .input-group {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .input-group input {
                width: 100%;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <div class="mode-badge" id="modeBadge">
            <!-- Mode badge will be inserted here -->
        </div>
        
        <header>
            <h1><i class="fas fa-share-alt"></i> P2P File Sharing Client</h1>
            <div class="mode-toggle">
                <span>Mock Mode</span>
                <label class="switch">
                    <input type="checkbox" id="modeToggle">
                    <span class="slider"></span>
                </label>
                <span>Real Mode</span>
            </div>
        </header>
        
        <!-- Local Peer Configuration -->
        <div class="config-section">
            <h2><i class="fas fa-desktop"></i> Local Peer Service</h2>
            <div class="input-group">
                <label for="localServiceUrl">Service URL:</label>
                <input type="text" id="localServiceUrl" value="http://localhost:8847" placeholder="Local service URL">
            </div>
            <div class="button-group">
                <button class="btn btn-primary" onclick="testLocalConnection()">
                    <i class="fas fa-plug"></i> Test Connection
                </button>
            </div>
        </div>
        
        <!-- Backend Server Configuration -->
        <div class="config-section">
            <h2><i class="fas fa-server"></i> Backend Server</h2>
            <div class="input-group">
                <label for="backendUrl">Server URL:</label>
                <input type="text" id="backendUrl" value="http://123.45.67.89:8000" placeholder="Backend server URL">
            </div>
            <div class="button-group">
                <button class="btn btn-success" onclick="connectBackend()">
                    <i class="fas fa-link"></i> Connect
                </button>
                <button class="btn btn-danger" onclick="disconnectBackend()">
                    <i class="fas fa-unlink"></i> Disconnect
                </button>
            </div>
        </div>
        
        <!-- Status Bar -->
        <div class="status-bar">
            <div>
                <div class="status-item">
                    <span class="status-indicator offline" id="localStatusIndicator"></span>
                    <span id="localConnectionStatus">Local Service: Disconnected</span>
                </div>
                <div class="status-item" style="margin-top: 8px;">
                    <span class="status-indicator offline" id="backendStatusIndicator"></span>
                    <span id="backendConnectionStatus">Backend: Disconnected</span>
                </div>
            </div>
            <div>
                <div>Last Update: <span id="lastUpdate">Never</span></div>
                <div style="margin-top: 8px;">Requests: <span id="statRequests">0</span> | Errors: <span id="statErrors">0</span></div>
            </div>
        </div>
        
        <!-- Files Sections -->
        <div class="files-section">
            <!-- Shared Files -->
            <div class="files-container">
                <h3>
                    <span><i class="fas fa-share-square"></i> Shared Files</span>
                    <button class="btn btn-success" style="padding: 8px 15px; font-size: 14px;" onclick="registerSharedFiles()">
                        <i class="fas fa-cloud-upload-alt"></i> Register to Backend
                    </button>
                </h3>
                <ul class="file-list" id="sharedFilesList">
                    <!-- Files will be added here dynamically -->
                </ul>
            </div>
            
            <!-- Available Files -->
            <div class="files-container">
                <h3>
                    <span><i class="fas fa-cloud-download-alt"></i> Available Files</span>
                    <button class="btn btn-primary" style="padding: 8px 15px; font-size: 14px;" onclick="refreshAvailableFiles()">
                        <i class="fas fa-sync"></i> Refresh
                    </button>
                </h3>
                <ul class="file-list" id="availableFilesList">
                    <!-- Files will be added here dynamically -->
                </ul>
            </div>
        </div>
        
        <!-- Log Output -->
        <div class="output-section" id="output">
            <div class="log-entry">
                <span class="log-timestamp">[System]</span>
                <span class="log-info">P2P File Sharing Client initialized. Click "Test Connection" to begin.</span>
            </div>
        </div>
    </div>

    <script>
        // =============================================
        // Configuration
        // =============================================
        const CONFIG = {
            MOCK_MODE: true, // Set to false for real backend
            MOCK_SUCCESS_RATE: 0.9, // 90% success rate for mock
            NETWORK_DELAY: { MIN: 10, MAX: 100 } // Simulated network latency
        };
        
        // State Management
        let localConnected = false;
        let backendConnected = false;
        let requestCount = 0;
        let errorCount = 0;
        
        // Mock Data Stores
        const mockSharedFiles = [
            { name: "project_document.pdf", size: 2543216, path: "/shared/docs/project.pdf" },
            { name: "important_notes.txt", size: 2048, path: "/shared/text/notes.txt" }
        ];
        
        let mockAvailableFiles = [
            { filename: "presentation.pptx", size: 5242880, peers: ["192.168.1.101"], hash: "mock-sha-12345" },
            { filename: "vacation_photos.zip", size: 156743289, peers: ["192.168.1.102"], hash: "mock-sha-67890" }
        ];
        
        // =============================================
        // Core Functions
        // =============================================
        
        function log(message, type = 'info') {
            const output = document.getElementById('output');
            const timestamp = new Date().toLocaleTimeString();
            
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.innerHTML = `
                <span class="log-timestamp">[${timestamp}]</span>
                <span class="log-${type}">${message}</span>
            `;
            
            output.appendChild(logEntry);
            output.scrollTop = output.scrollHeight;
            document.getElementById('lastUpdate').textContent = timestamp;
            
            // Update stats
            requestCount++;
            if (type === 'error') errorCount++;
            document.getElementById('statRequests').textContent = requestCount;
            document.getElementById('statErrors').textContent = errorCount;
        }
        
        function updateConnectionStatus() {
            // Update local service status
            const localIndicator = document.getElementById('localStatusIndicator');
            const localStatus = document.getElementById('localConnectionStatus');
            localIndicator.className = localConnected ? 'status-indicator online' : 'status-indicator offline';
            localStatus.textContent = localConnected ? 'Local Service: Connected' : 'Local Service: Disconnected';
            
            // Update backend status
            const backendIndicator = document.getElementById('backendStatusIndicator');
            const backendStatus = document.getElementById('backendConnectionStatus');
            backendIndicator.className = backendConnected ? 'status-indicator online' : 'status-indicator offline';
            backendStatus.textContent = backendConnected ? 'Backend: Connected' : 'Backend: Disconnected';
            
            // Update mode badge
            const modeBadge = document.getElementById('modeBadge');
            modeBadge.className = CONFIG.MOCK_MODE ? 'mode-badge mock-mode' : 'mode-badge real-mode';
            modeBadge.textContent = CONFIG.MOCK_MODE ? 'MOCK MODE' : 'REAL MODE';
        }
        
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        function getLocalServiceUrl() {
            return document.getElementById('localServiceUrl').value.trim() || "http://localhost:8847";
        }
        
        function getBackendUrl() {
            return document.getElementById('backendUrl').value.trim() || "http://123.45.67.89:8000";
        }
        
        function getMockLocalIP() {
            return `192.168.1.${100 + Math.floor(Math.random() * 155)}`;
        }
        
        // =============================================
        // Connection Management
        // =============================================
        
        async function testLocalConnection() {
            const serviceUrl = getLocalServiceUrl();
            log(`Testing connection to local service: ${serviceUrl}`);
            
            if (CONFIG.MOCK_MODE) {
                // Mock implementation
                try {
                    log("Simulating local connection...");
                    
                    // Simulate network delay
                    await new Promise(resolve => 
                        setTimeout(resolve, 300 + Math.random() * 500)
                    );
                    
                    // Random success/failure
                    if (Math.random() < CONFIG.MOCK_SUCCESS_RATE) {
                        localConnected = true;
                        updateConnectionStatus();
                        log("‚úÖ Local service connected (MOCK)", 'success');
                    } else {
                        throw new Error("Connection timed out");
                    }
                } catch (error) {
                    localConnected = false;
                    updateConnectionStatus();
                    log(`‚ùå Local connection failed: ${error.message}`, 'error');
                }
            } else {
                // Real implementation
                try {
                    const response = await fetch(`${serviceUrl}/api/status`);
                    
                    if (response.ok) {
                        const data = await response.json();
                        localConnected = true;
                        updateConnectionStatus();
                        log(`‚úÖ Local service connected! Status: ${data.status}`, 'success');
                    } else {
                        throw new Error(`HTTP ${response.status}`);
                    }
                } catch (error) {
                    localConnected = false;
                    updateConnectionStatus();
                    log(`‚ùå Local connection failed: ${error.message}`, 'error');
                }
            }
        }
        
        async function connectBackend() {
            const backendUrl = getBackendUrl();
            log(`Connecting to backend: ${backendUrl}`);
            
            if (CONFIG.MOCK_MODE) {
                // Mock implementation
                try {
                    log("Simulating backend connection...");
                    
                    // Simulate network delay
                    await new Promise(resolve => 
                        setTimeout(resolve, 400 + Math.random() * 700)
                    );
                    
                    // Random success/failure
                    if (Math.random() < CONFIG.MOCK_SUCCESS_RATE) {
                        backendConnected = true;
                        updateConnectionStatus();
                        log("‚úÖ Backend connected (MOCK)", 'success');
                        
                        // Load available files after connection
                        refreshAvailableFiles();
                    } else {
                        throw new Error("Connection refused");
                    }
                } catch (error) {
                    backendConnected = false;
                    updateConnectionStatus();
                    log(`‚ùå Backend connection failed: ${error.message}`, 'error');
                }
            } else {
                // Real implementation
                try {
                    const response = await fetch(`${backendUrl}/api/status`);
                    
                    if (response.ok) {
                        const data = await response.json();
                        backendConnected = true;
                        updateConnectionStatus();
                        log(`‚úÖ Backend connected! Peers: ${data.peers || 0}`, 'success');
                        
                        // Load available files after connection
                        refreshAvailableFiles();
                    } else {
                        throw new Error(`HTTP ${response.status}`);
                    }
                } catch (error) {
                    backendConnected = false;
                    updateConnectionStatus();
                    log(`‚ùå Backend connection failed: ${error.message}`, 'error');
                }
            }
        }
        
        function disconnectBackend() {
            backendConnected = false;
            updateConnectionStatus();
            document.getElementById('availableFilesList').innerHTML = '';
            log("Disconnected from backend", 'info');
        }
        
        // =============================================
        // File Operations
        // =============================================
        
        async function registerSharedFiles() {
            if (!backendConnected) {
                log("‚ö†Ô∏è Please connect to backend first", 'warning');
                return;
            }
            
            if (CONFIG.MOCK_MODE) {
                // Mock implementation
                try {
                    log("Registering shared files with backend (MOCK)...");
                    
                    // Simulate delay
                    await new Promise(resolve => 
                        setTimeout(resolve, 500 + Math.random() * 500)
                    );
                    
                    // Process each file
                    for (const file of mockSharedFiles) {
                        const fileHash = `mock-sha-${file.name.replace(/\.[^/.]+$/, "")}-${file.size}`;
                        const newFile = {
                            filename: file.name,
                            size: file.size,
                            peers: [getMockLocalIP()],
                            hash: fileHash
                        };
                        
                        mockAvailableFiles.push(newFile);
                        log(`‚úÖ Registered: ${file.name} (${formatFileSize(file.size)})`, 'success');
                    }
                    
                    // Refresh available files
                    refreshAvailableFiles();
                } catch (error) {
                    log(`‚ùå Registration failed: ${error.message}`, 'error');
                }
            } else {
                // Real implementation
                try {
                    log("Registering shared files with backend...");
                    
                    // Get shared files from local service
                    const serviceUrl = getLocalServiceUrl();
                    const response = await fetch(`${serviceUrl}/api/files`);
                    const data = await response.json();
                    
                    if (!data.files || data.files.length === 0) {
                        log("‚ÑπÔ∏è No files to register", 'info');
                        return;
                    }
                    
                    // Register each file
                    for (const file of data.files) {
                        try {
                            // In a real implementation, we would calculate the SHA hash here
                            const fileHash = "real-sha-to-be-calculated";
                            
                            // Send registration to backend
                            const backendUrl = getBackendUrl();
                            const registerResponse = await fetch(`${backendUrl}/api/register`, {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({
                                    filename: file.name,
                                    size: file.size,
                                    hash: fileHash,
                                    peer_url: serviceUrl
                                })
                            });
                            
                            if (registerResponse.ok) {
                                log(`‚úÖ Registered: ${file.name}`, 'success');
                            } else {
                                throw new Error(`HTTP ${registerResponse.status}`);
                            }
                        } catch (error) {
                            log(`‚ö†Ô∏è Failed to register ${file.name}: ${error.message}`, 'warning');
                        }
                    }
                    
                    // Refresh available files
                    refreshAvailableFiles();
                } catch (error) {
                    log(`‚ùå Registration failed: ${error.message}`, 'error');
                }
            }
        }
        
        async function refreshAvailableFiles() {
            if (!backendConnected) {
                log("‚ö†Ô∏è Please connect to backend first", 'warning');
                return;
            }
            
            if (CONFIG.MOCK_MODE) {
                // Mock implementation
                try {
                    log("Refreshing available files (MOCK)...");
                    
                    // Simulate delay
                    await new Promise(resolve => 
                        setTimeout(resolve, 400 + Math.random() * 600)
                    );
                    
                    const listElement = document.getElementById('availableFilesList');
                    listElement.innerHTML = '';
                    
                    if (mockAvailableFiles.length === 0) {
                        listElement.innerHTML = '<li class="no-files">No files available</li>';
                        log("‚ÑπÔ∏è No files available on backend", 'info');
                        return;
                    }
                    
                    log(`üìÅ Found ${mockAvailableFiles.length} available files`, 'success');
                    
                    mockAvailableFiles.forEach(file => {
                        const li = document.createElement('li');
                        li.className = 'file-item';
                        li.innerHTML = `
                            <div class="file-info">
                                <div class="file-name">${file.filename}</div>
                                <div class="file-size">${formatFileSize(file.size)}</div>
                                <div class="file-peers">${file.peers.length} peer(s)</div>
                            </div>
                            <button class="action-btn download-btn" 
                                    onclick="downloadFile('${file.filename}', '${file.peers[0]}')">
                                <i class="fas fa-download"></i> Download
                            </button>
                        `;
                        listElement.appendChild(li);
                    });
                } catch (error) {
                    log(`‚ùå Failed to refresh files: ${error.message}`, 'error');
                }
            } else {
                // Real implementation
                try {
                    log("Fetching available files from backend...");
                    
                    const backendUrl = getBackendUrl();
                    const response = await fetch(`${backendUrl}/api/files`);
                    const data = await response.json();
                    
                    const listElement = document.getElementById('availableFilesList');
                    listElement.innerHTML = '';
                    
                    if (!data.files || data.files.length === 0) {
                        listElement.innerHTML = '<li class="no-files">No files available</li>';
                        log("‚ÑπÔ∏è No files available on backend", 'info');
                        return;
                    }
                    
                    log(`üìÅ Found ${data.files.length} available files`, 'success');
                    
                    data.files.forEach(file => {
                        const li = document.createElement('li');
                        li.className = 'file-item';
                        li.innerHTML = `
                            <div class="file-info">
                                <div class="file-name">${file.filename}</div>
                                <div class="file-size">${formatFileSize(file.size)}</div>
                                <div class="file-peers">${file.peers.length} peer(s)</div>
                            </div>
                            <button class="action-btn download-btn" 
                                    onclick="downloadFile('${file.filename}', '${file.peers[0]}')">
                                <i class="fas fa-download"></i> Download
                            </button>
                        `;
                        listElement.appendChild(li);
                    });
                } catch (error) {
                    log(`‚ùå Failed to refresh files: ${error.message}`, 'error');
                }
            }
        }
        
        async function downloadFile(filename, peerUrl) {
            log(`Starting download: ${filename} from ${peerUrl}`);
            
            if (CONFIG.MOCK_MODE) {
                // Mock implementation
                try {
                    // Create progress element
                    const progressId = `progress-${filename.replace(/\W/g, '_')}`;
                    log(`‚è≥ Download progress: 
                        <div class="file-download">
                            <div>${filename}</div>
                            <div class="progress">
                                <div id="${progressId}" class="progress-bar" style="width:0%"></div>
                            </div>
                        </div>`, 'info');
                    
                    // Simulate download progress
                    for (let progress = 0; progress <= 100; progress += 10) {
                        await new Promise(resolve => setTimeout(resolve, 200));
                        const bar = document.getElementById(progressId);
                        if (bar) bar.style.width = `${progress}%`;
                    }
                    
                    log(`‚úÖ Download complete: ${filename}`, 'success');
                } catch (error) {
                    log(`‚ùå Download failed: ${error.message}`, 'error');
                }
            } else {
                // Real implementation
                try {
                    // Create progress element
                    const progressId = `progress-${filename.replace(/\W/g, '_')}`;
                    log(`‚è≥ Download progress: 
                        <div class="file-download">
                            <div>${filename}</div>
                            <div class="progress">
                                <div id="${progressId}" class="progress-bar" style="width:0%"></div>
                            </div>
                        </div>`, 'info');
                    
                    // In a real implementation, we would use:
                    // const response = await fetch(`${peerUrl}/download/${filename}`);
                    // And track download progress
                    
                    // Simulating real download for demo
                    for (let progress = 0; progress <= 100; progress += 5) {
                        await new Promise(resolve => setTimeout(resolve, 150));
                        const bar = document.getElementById(progressId);
                        if (bar) bar.style.width = `${progress}%`;
                    }
                    
                    log(`‚úÖ Download complete: ${filename}`, 'success');
                } catch (error) {
                    log(`‚ùå Download failed: ${error.message}`, 'error');
                }
            }
        }
        
        // =============================================
        // Initialization
        // =============================================
        
        function initializeUI() {
            // Populate shared files list
            const sharedList = document.getElementById('sharedFilesList');
            mockSharedFiles.forEach(file => {
                const li = document.createElement('li');
                li.className = 'file-item';
                li.innerHTML = `
                    <div class="file-info">
                        <div class="file-name">${file.name}</div>
                        <div class="file-size">${formatFileSize(file.size)}</div>
                    </div>
                `;
                sharedList.appendChild(li);
            });
            
            // Set up mode toggle
            const modeToggle = document.getElementById('modeToggle');
            modeToggle.checked = !CONFIG.MOCK_MODE;
            modeToggle.addEventListener('change', () => {
                CONFIG.MOCK_MODE = !modeToggle.checked;
                updateConnectionStatus();
                log(`Switched to ${CONFIG.MOCK_MODE ? 'MOCK' : 'REAL'} mode`);
            });
            
            // Initialize status
            updateConnectionStatus();
            log("P2P File Sharing Client initialized", 'success');
        }
        
        // Initialize when page loads
        window.onload = initializeUI;
    </script>
</body>
</html>
